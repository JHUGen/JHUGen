ifndef ROOTSYS
all:
	@echo "ROOTSYS is not set. Please set ROOT environment properly"; echo
else

CMSROOT = ./
#MODULES=$(CMSROOT)modules/
#OBJECTS=$(CMSROOT)objects/
MODULES=$(CMSROOT)
OBJECTS=$(CMSROOT)
ROOFITINCLUDE = 
RM  = /bin/rm
INCLUDE = -I$(CMSROOT) $(ROOFITINCLUDE)
Comp = gfort

# Linking LHAPDF
# link pdfs via LHA library ('Yes' or 'No')
UseLHAPDF=No
# directory which contains libLHAPDF.a, libLHAPDF.la, libLHAPDF.so
MyLHADir=/./
# remember to export
#          LD_LIBRARY_PATH=/.../LHAPDF-x.y.z/lib/:${LD_LIBRARY_PATH}
#          LHAPDF_DATA_PATH=/.../LHAPDF-x.y.z/share/LHAPDF/:${LHAPDF_DATA_PATH}
ifeq ($(UseLHAPDF),Yes)
   LHAPDFflags = -L$(MyLHADir) -lLHAPDF -DuseLHAPDF=1
else
   LHAPDFflags = -DuseLHAPDF=0
endif


ifeq ($(Comp),ifort)
	fcomp = ifort -fpp -O2 -vec-report0 -Dcompiler=1 -D_def_melatools_ -lifcore -fPIC
endif
ifeq ($(Comp),gfort)
	fcomp = gfortran -O0 -ffree-line-length-none -Dcompiler=2 -D_def_melatools_ $(LHAPDFflags) -fno-automatic -fno-f2c  -fPIC -g 
endif

ifeq ($(Comp),gfort)
	ccomp = gcc -D_def_melatools_
endif
ifeq ($(Comp),ifort)
	ccomp = icc -D_def_melatools_
endif

ifeq ($(Comp),gfort)
	clib =  -lm -lgfortran
endif
ifeq ($(Comp),ifort)
	clib =  -lm -lirc
endif


LIB = libjhugenmela.so

all:    libs
	g++ -Wl,-soname,$(LIB) -shared -o $(LIB) *.o
#	mv *.o $(OBJECTS)
#	mv *.mod $(MODULES)

libs: CALLING_cpHTO.o \
	Cteq61Pdf.o mstwpdf.o NNPDFDriver.o \
	mod_Parameters.o mod_Misc.o mod_Kinematics.o \
	mod_JHUGenMELA.o mod_JHUGen.o \
	mod_Higgs.o mod_Graviton.o mod_Zprime.o \
	mod_HiggsJJ.o mod_HiggsJ.o mod_VHiggs.o \
	mod_TopDecay.o mod_TTBHiggs.o mod_THiggs.o

CALLING_cpHTO.o: ./CPS/CALLING_cpHTO.f
	@echo " "
	@echo " compiling CALLING_cpHTO.f with "$(Comp)
	$(fcomp) -c ./CPS/CALLING_cpHTO.f


Cteq61Pdf.o: ./pdfs/Cteq61Pdf.f
	@echo " "
	@echo " compiling Cteq61Pdf.f with "$(Comp)
	$(fcomp) -c ./pdfs/Cteq61Pdf.f


mstwpdf.o: ./pdfs/mstwpdf.f
	@echo " "
	@echo " compiling mstwpdf.f with "$(Comp)
	$(fcomp) -c ./pdfs/mstwpdf.f


NNPDFDriver.o: ./pdfs/NNPDFDriver.f
	@echo " "
	@echo " compiling NNPDFDriver.f with "$(Comp)
	$(fcomp) -c ./pdfs/NNPDFDriver.f


vegas.o: ./vegas.f
	@echo " "
	@echo " compiling vegas.f with "$(Comp)
	$(fcomp) -c ./vegas.f


mod_Parameters.o: mod_Parameters.F90
	@echo " "
	@echo " compiling mod_Parameters.F90 with "$(Comp)
	$(fcomp) -c mod_Parameters.F90

mod_JHUGenMELA.o: mod_JHUGenMELA.F90
	@echo " "
	@echo " compiling mod_JHUGenMELA.F90 with "$(Comp)
	$(fcomp) -c mod_JHUGenMELA.F90

mod_Misc.o: mod_Misc.F90
	@echo " "
	@echo " compiling mod_Misc.F90 with "$(Comp)
	$(fcomp) -c mod_Misc.F90

mod_Kinematics.o: mod_Kinematics.F90 mod_Parameters.F90
	@echo " "
	@echo " compiling mod_Kinematics.F90 with "$(Comp)
	$(fcomp) -c mod_Kinematics.F90

mod_JHUGen.o: mod_JHUGen.F90 mod_Kinematics.F90 mod_Parameters.F90 mod_Misc.F90
	@echo " "
	@echo " compiling mod_JHUGen.F90 with "$(Comp)
	$(fcomp) -c mod_JHUGen.F90


mod_Higgs.o: mod_Higgs.F90 mod_Misc.F90 mod_Parameters.F90
	@echo " "
	@echo " compiling mod_Higgs.F90 with "$(Comp)
	$(fcomp) -c mod_Higgs.F90


mod_Zprime.o: mod_Zprime.F90 mod_Misc.F90 mod_Parameters.F90
	@echo " "
	@echo " compiling mod_Zprime.F90 with "$(Comp)
	$(fcomp) -c mod_Zprime.F90

mod_Graviton.o: mod_Graviton.F90 mod_Misc.F90 mod_Parameters.F90
	@echo " "
	@echo " compiling mod_Graviton.F90 with "$(Comp)
	$(fcomp) -c mod_Graviton.F90

mod_HiggsJ.o: mod_HiggsJ.F90 mod_Parameters.F90
	@echo " "
	@echo " compiling mod_HiggsJ.F90 with "$(Comp)
	$(fcomp) -c mod_HiggsJ.F90

mod_HiggsJJ.o: mod_HiggsJJ.F90 mod_Misc.F90 mod_Parameters.F90
	@echo " "
	@echo " compiling mod_HiggsJJ.F90 with "$(Comp)
	$(fcomp) -c mod_HiggsJJ.F90

mod_VHiggs.o: mod_VHiggs.F90 mod_Parameters.F90
	@echo " "
	@echo " compiling mod_VHiggs.F90 with "$(Comp)
	$(fcomp) -c mod_VHiggs.F90 

mod_TopDecay.o: mod_TopDecay.F90 mod_Parameters.F90
	@echo " "
	@echo " compiling mod_TopDecay.F90 with "$(Comp)
	$(fcomp) -c mod_TopDecay.F90  

mod_TTBHiggs.o: mod_TTBHiggs.F90 mod_Parameters.F90
	@echo " "
	@echo " compiling mod_TTBHiggs.F90 with "$(Comp)
	$(fcomp) -c mod_TTBHiggs.F90  

mod_THiggs.o: mod_THiggs.F90 mod_Parameters.F90
	@echo " "
	@echo " compiling mod_THiggs.F90 with "$(Comp)
	$(fcomp) -c mod_THiggs.F90  

clean:
	@echo " deleting object files"
	rm -f *.so $(OBJECTS)*.o $(MODULES)*.mod

endif

# supresses command calls
.SILENT:
